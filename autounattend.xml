<?xml version="1.0" encoding="utf-8"?>
<unattend xmlns="urn:schemas-microsoft-com:unattend" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State">
	<!-- Refactored by Jules - Senior Windows Deployment Architect -->
	<settings pass="offlineServicing"></settings>
	<settings pass="windowsPE">
		<component name="Microsoft-Windows-International-Core-WinPE" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
			<UILanguage>fr-FR</UILanguage>
		</component>
		<component name="Microsoft-Windows-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
			<UserData>
				<ProductKey>
					<Key>VK7JG-NPHTM-C97JM-9MPGT-3V66T</Key>
					<WillShowUI>OnError</WillShowUI>
				</ProductKey>
				<AcceptEula>true</AcceptEula>
			</UserData>
			<UseConfigurationSet>false</UseConfigurationSet>
		</component>
	</settings>
	<settings pass="generalize"></settings>
	<settings pass="specialize">
		<component name="Microsoft-Windows-Deployment" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
			<RunSynchronous>
				<RunSynchronousCommand wcm:action="add">
					<Order>1</Order>
					<Path>powershell.exe -WindowStyle "Normal" -NoProfile -Command "$xml = [xml]::new(); $xml.Load('C:\Windows\Panther\unattend.xml'); $sb = [scriptblock]::Create( $xml.unattend.Extensions.ExtractScript ); Invoke-Command -ScriptBlock $sb -ArgumentList $xml;"</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>2</Order>
					<Path>powershell.exe -WindowStyle "Normal" -ExecutionPolicy "Unrestricted" -NoProfile -File "C:\Windows\Setup\Scripts\Specialize.ps1"</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>3</Order>
					<Path>reg.exe load "HKU\DefaultUser" "C:\Users\Default\NTUSER.DAT"</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>4</Order>
					<Path>powershell.exe -WindowStyle "Normal" -ExecutionPolicy "Unrestricted" -NoProfile -File "C:\Windows\Setup\Scripts\DefaultUser.ps1"</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>5</Order>
					<Path>reg.exe unload "HKU\DefaultUser"</Path>
				</RunSynchronousCommand>
			</RunSynchronous>
		</component>
	</settings>
	<settings pass="auditSystem"></settings>
	<settings pass="auditUser"></settings>
	<settings pass="oobeSystem">
		<component name="Microsoft-Windows-International-Core" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
			<InputLocale>040c:0000040c</InputLocale>
			<SystemLocale>fr-FR</SystemLocale>
			<UILanguage>fr-FR</UILanguage>
			<UserLocale>fr-FR</UserLocale>
		</component>
		<component name="Microsoft-Windows-Shell-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
			<UserAccounts>
				<LocalAccounts>
					<LocalAccount wcm:action="add">
						<Name>Antho</Name>
						<DisplayName></DisplayName>
						<Group>Administrators</Group>
						<Password>
							<Value></Value>
							<PlainText>true</PlainText>
						</Password>
					</LocalAccount>
				</LocalAccounts>
			</UserAccounts>
			<AutoLogon>
				<Username>Antho</Username>
				<Enabled>true</Enabled>
				<LogonCount>1</LogonCount>
				<Password>
					<Value></Value>
					<PlainText>true</PlainText>
				</Password>
			</AutoLogon>
			<OOBE>
				<ProtectYourPC>3</ProtectYourPC>
				<HideEULAPage>true</HideEULAPage>
				<HideWirelessSetupInOOBE>true</HideWirelessSetupInOOBE>
				<HideOnlineAccountScreens>false</HideOnlineAccountScreens>
			</OOBE>
		</component>
	</settings>
	<Extensions xmlns="https://schneegans.de/windows/unattend-generator/">
		<ExtractScript>

param(
    [xml] $Document
);

foreach( $file in $Document.unattend.Extensions.File ) {
    $path = [System.Environment]::ExpandEnvironmentVariables( $file.GetAttribute( 'path' ) );
    mkdir -Path( $path | Split-Path -Parent ) -ErrorAction 'SilentlyContinue';
    $encoding = switch( [System.IO.Path]::GetExtension( $path ) ) {
        { $_ -in '.ps1', '.xml' } { [System.Text.Encoding]::UTF8; }
        { $_ -in '.reg', '.vbs', '.js' } { [System.Text.UnicodeEncoding]::new( $false, $true ); }
        default { [System.Text.Encoding]::Default; }
    };
    $bytes = $encoding.GetPreamble() + $encoding.GetBytes( $file.InnerText.Trim() );
    [System.IO.File]::WriteAllBytes( $path, $bytes );
}

		</ExtractScript>
		<File path="C:\Windows\Setup\Scripts\Lib\Helper.ps1">
function Get-InstallMedia {
    $drives = Get-PSDrive -PSProvider FileSystem
    foreach ($drive in $drives) {
        $path = Join-Path -Path $drive.Root -ChildPath &quot;drivers&quot;
        if (Test-Path -Path $path -PathType Container) {
            return $drive.Root
        }
    }
    return $null
}

function Get-InstallerFile {
    param([string]$Path)
    if (Test-Path -Path $Path) {
        $file = Get-ChildItem -Path $Path -Filter &quot;*.exe&quot; | Select-Object -First 1
        if ($file) { return $file.FullName }
    }
    return $null
}

function Write-Log {
    param(
        [string]$Message,
        [string]$Path = &quot;$env:SystemRoot\Setup\Scripts\Setup.log&quot;
    )
    $timestamp = Get-Date -Format &quot;yyyy-MM-dd HH:mm:ss&quot;
    $logEntry = &quot;[$timestamp] $Message&quot;
    Add-Content -Path $Path -Value $logEntry -ErrorAction SilentlyContinue
    Write-Host $logEntry
}

		</File>
		<File path="C:\Windows\Setup\Scripts\Drivers\Install-Network.ps1">
$ErrorActionPreference = 'Stop'
. &quot;$PSScriptRoot\Lib\Helper.ps1&quot;

Write-Log &quot;Starting Network Driver Installation...&quot;
$mediaRoot = Get-InstallMedia

if ($mediaRoot) {
    $driverPath = Join-Path -Path $mediaRoot -ChildPath &quot;drivers\network&quot;
    if (Test-Path -Path $driverPath) {
        Write-Log &quot;Found network drivers at $driverPath&quot;
        try {
            $pnputilArgs = &quot;/add-driver `&quot;$driverPath\*.inf`&quot; /subdirs /install&quot;
            Start-Process -FilePath &quot;pnputil.exe&quot; -ArgumentList $pnputilArgs -Wait -NoNewWindow
            Write-Log &quot;Network driver installation completed.&quot;
        }
        catch {
            Write-Log &quot;Error installing network drivers: $_&quot;
        }
    } else {
        Write-Log &quot;No network drivers found in $driverPath&quot;
    }
} else {
    Write-Log &quot;Install media not found.&quot;
}

		</File>
		<File path="C:\Windows\Setup\Scripts\Drivers\Install-Nvidia.ps1">
$ErrorActionPreference = 'Stop'
. &quot;$PSScriptRoot\Lib\Helper.ps1&quot;

Write-Log &quot;Starting Nvidia Driver Installation...&quot;
$mediaRoot = Get-InstallMedia

if ($mediaRoot) {
    $driverDir = Join-Path -Path $mediaRoot -ChildPath &quot;drivers\nvidia&quot;
    $setupPath = Get-InstallerFile -Path $driverDir

    if ($setupPath) {
        Write-Log &quot;Found Nvidia setup at $setupPath&quot;
        Write-Progress -Activity &quot;Installing Drivers&quot; -Status &quot;Installing Nvidia GPU Driver...&quot; -PercentComplete 0
        try {
            Unblock-File -Path $setupPath -ErrorAction SilentlyContinue
            Start-Process -FilePath $setupPath -ArgumentList '-s -n -f -noreboot' -Wait
            Write-Log &quot;Nvidia driver installation completed.&quot;
        }
        catch {
            Write-Log &quot;Error installing Nvidia drivers: $_&quot;
        }
        finally {
            Write-Progress -Activity &quot;Installing Drivers&quot; -Completed
        }
    } else {
        Write-Log &quot;Nvidia installer not found in $driverDir&quot;
    }
} else {
    Write-Log &quot;Install media not found.&quot;
}

		</File>
		<File path="C:\Windows\Setup\Scripts\Drivers\Install-AMD.ps1">
$ErrorActionPreference = 'Stop'
. &quot;$PSScriptRoot\Lib\Helper.ps1&quot;

Write-Log &quot;Starting AMD Chipset Driver Installation...&quot;
$mediaRoot = Get-InstallMedia

if ($mediaRoot) {
    $driverDir = Join-Path -Path $mediaRoot -ChildPath &quot;drivers\amd&quot;
    $setupPath = Get-InstallerFile -Path $driverDir

    if ($setupPath) {
        Write-Log &quot;Found AMD setup at $setupPath&quot;
        Write-Progress -Activity &quot;Installing Drivers&quot; -Status &quot;Installing AMD Chipset Driver...&quot; -PercentComplete 0
        try {
            Unblock-File -Path $setupPath -ErrorAction SilentlyContinue
            Start-Process -FilePath $setupPath -ArgumentList &quot;/S&quot;, &quot;-noreboot&quot; -Wait
            Write-Log &quot;AMD Chipset driver installation completed.&quot;
        }
        catch {
            Write-Log &quot;Error installing AMD Chipset drivers: $_&quot;
        }
        finally {
            Write-Progress -Activity &quot;Installing Drivers&quot; -Completed
        }
    } else {
        Write-Log &quot;AMD installer not found in $driverDir&quot;
    }
} else {
    Write-Log &quot;Install media not found.&quot;
}

		</File>
		<File path="C:\Windows\Setup\Scripts\Drivers\Install-Focusrite.ps1">
$ErrorActionPreference = 'Stop'
. &quot;$PSScriptRoot\Lib\Helper.ps1&quot;

Write-Log &quot;Starting Focusrite Driver Installation...&quot;
$mediaRoot = Get-InstallMedia

if ($mediaRoot) {
    $driverDir = Join-Path -Path $mediaRoot -ChildPath &quot;drivers\focusrite&quot;
    $setupPath = Get-InstallerFile -Path $driverDir

    if ($setupPath) {
        Write-Log &quot;Found Focusrite setup at $setupPath&quot;
        Write-Progress -Activity &quot;Installing Drivers&quot; -Status &quot;Installing Focusrite Audio Driver...&quot; -PercentComplete 0
        try {
            Unblock-File -Path $setupPath -ErrorAction SilentlyContinue
            Start-Process -FilePath $setupPath -ArgumentList '/VERYSILENT /SUPPRESSMSGBOXES /NORESTART /SP-' -Wait
            Write-Log &quot;Focusrite driver installation completed.&quot;
        }
        catch {
            Write-Log &quot;Error installing Focusrite drivers: $_&quot;
        }
        finally {
            Write-Progress -Activity &quot;Installing Drivers&quot; -Completed
        }
    } else {
        Write-Log &quot;Focusrite installer not found in $driverDir&quot;
    }
} else {
    Write-Log &quot;Install media not found.&quot;
}

		</File>
		<File path="C:\Windows\Setup\Scripts\Apps\Install-Chrome.ps1">
$ErrorActionPreference = 'Stop'
. &quot;$PSScriptRoot\Lib\Helper.ps1&quot;

Write-Log &quot;Starting Chrome Installation...&quot;
$mediaRoot = Get-InstallMedia
$localInstaller = $null

if ($mediaRoot) {
    # Check for local installer in common locations
    $possiblePaths = @(
        (Join-Path $mediaRoot &quot;apps\chrome&quot;),
        (Join-Path $mediaRoot &quot;drivers\apps\chrome&quot;),
        (Join-Path $mediaRoot &quot;Apps&quot;),
        (Join-Path $mediaRoot &quot;Drivers\Apps&quot;)
    )

    foreach ($path in $possiblePaths) {
         if (Test-Path $path) {
             $localInstaller = Get-InstallerFile -Path $path
             if ($localInstaller) { break }
         }
    }
}

if ($localInstaller) {
    Write-Log &quot;Found local Chrome installer at $localInstaller&quot;
    Write-Progress -Activity &quot;Installing Apps&quot; -Status &quot;Installing Chrome from local media...&quot;
    try {
        Unblock-File -Path $localInstaller -ErrorAction SilentlyContinue
        Start-Process -FilePath $localInstaller -ArgumentList '/silent /install' -Wait
        Write-Log &quot;Chrome installation (local) completed.&quot;
    } catch {
        Write-Log &quot;Error installing Chrome locally: $_&quot;
    }
} else {
    Write-Log &quot;Local installer not found. Attempting download...&quot;
    # Network wait loop
    $maxRetries = 30 # 30 * 2s = 60 seconds wait
    $retry = 0
    $connected = $false

    while (-not $connected -and $retry -lt $maxRetries) {
        try {
            # Simple connectivity check
            $null = [System.Net.Dns]::GetHostEntry(&quot;dl.google.com&quot;)
            $connected = $true
        } catch {
            $retry++
            Write-Log &quot;Waiting for network connectivity... ($retry/$maxRetries)&quot;
            Start-Sleep -Seconds 2
        }
    }

    if ($connected) {
        try {
            [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
            $url = 'https://dl.google.com/chrome/install/chrome_installer.exe'
            $dest = &quot;$env:TEMP\chrome.exe&quot;

            Write-Log &quot;Downloading Chrome from $url...&quot;
            Write-Progress -Activity &quot;Installing Apps&quot; -Status &quot;Downloading Chrome...&quot;
            Invoke-WebRequest -Uri $url -OutFile $dest -UseBasicParsing

            if (Test-Path -Path $dest -And (Get-Item $dest).Length -gt 0) {
                Write-Log &quot;Installing Chrome...&quot;
                Write-Progress -Activity &quot;Installing Apps&quot; -Status &quot;Installing Chrome...&quot;
                Unblock-File -Path $dest -ErrorAction SilentlyContinue
                Start-Process -FilePath $dest -ArgumentList '/silent /install' -Wait
                Remove-Item -Path $dest -Force -ErrorAction SilentlyContinue
                Write-Log &quot;Chrome installation completed.&quot;
            } else {
                Write-Log &quot;Failed to download Chrome installer.&quot;
            }
        } catch {
            Write-Log &quot;Error downloading/installing Chrome: $_&quot;
        }
    } else {
        Write-Log &quot;No network connectivity. Skipping Chrome installation.&quot;
    }
}
finally {
    Write-Progress -Activity &quot;Installing Apps&quot; -Completed
}

		</File>
		<File path="C:\Windows\Setup\Scripts\Tweaks\Remove-Bloatware.ps1">
$ErrorActionPreference = 'Stop'
. &quot;$PSScriptRoot\Lib\Helper.ps1&quot;

$packagesToRemove = @(
    'Microsoft.Microsoft3DViewer',
    'Microsoft.BingSearch',
    'Microsoft.WindowsCamera',
    'Clipchamp.Clipchamp',
    'Microsoft.WindowsAlarms',
    'Microsoft.Copilot',
    'Microsoft.Windows.DevHome',
    'MicrosoftCorporationII.MicrosoftFamily',
    'Microsoft.WindowsFeedbackHub',
    'Microsoft.GetHelp',
    'Microsoft.Getstarted',
    'microsoft.windowscommunicationsapps',
    'Microsoft.WindowsMaps',
    'Microsoft.MixedReality.Portal',
    'Microsoft.BingNews',
    'Microsoft.WindowsNotepad',
    'Microsoft.MicrosoftOfficeHub',
    'Microsoft.Office.OneNote',
    'Microsoft.OutlookForWindows',
    'Microsoft.MSPaint',
    'Microsoft.People',
    'Microsoft.Windows.Photos',
    'Microsoft.PowerAutomateDesktop',
    'MicrosoftCorporationII.QuickAssist',
    'Microsoft.SkypeApp',
    'Microsoft.MicrosoftSolitaireCollection',
    'Microsoft.MicrosoftStickyNotes',
    'MicrosoftTeams',
    'MSTeams',
    'Microsoft.Todos',
    'Microsoft.WindowsSoundRecorder',
    'Microsoft.Wallet',
    'Microsoft.BingWeather',
    'Microsoft.ZuneVideo',
    'Microsoft.Windows.Ai.Copilot.Provider'
)

$capabilitiesToRemove = @(
    'Print.Fax.Scan',
    'Browser.InternetExplorer',
    'MathRecognizer',
    'OneCoreUAP.OneSync',
    'App.Support.QuickAssist',
    'App.StepsRecorder',
    'Hello.Face',
    'Media.WindowsMediaPlayer',
    'Microsoft.Windows.WordPad'
)

$featuresToRemove = @(
    'MediaPlayback',
    'Microsoft-RemoteDesktopConnection',
    'Recall'
)

Write-Log &quot;Starting Debloating Process...&quot;

# Remove Appx Provisioned Packages
Write-Log &quot;Removing Appx Provisioned Packages...&quot;
$provisioned = Get-AppxProvisionedPackage -Online
$total = $packagesToRemove.Count
$i = 0
foreach ($package in $packagesToRemove) {
    $i++
    Write-Progress -Activity &quot;Debloating Windows&quot; -Status &quot;Removing Appx: $package&quot; -PercentComplete (($i / $total) * 100)
    $found = $provisioned | Where-Object { $_.DisplayName -eq $package }
    if ($found) {
        Write-Log &quot;Removing $package...&quot;
        try {
            Remove-AppxProvisionedPackage -Online -PackageName $found.PackageName -ErrorAction Continue | Out-Null
        } catch {
            Write-Log &quot;Failed to remove $package: $_&quot;
        }
    }
}

# Remove Capabilities
Write-Log &quot;Removing Windows Capabilities...&quot;
$capabilities = Get-WindowsCapability -Online
$totalCaps = $capabilitiesToRemove.Count
$j = 0
foreach ($capName in $capabilitiesToRemove) {
    $j++
    Write-Progress -Activity &quot;Debloating Windows&quot; -Status &quot;Removing Capability: $capName&quot; -PercentComplete (($j / $totalCaps) * 100)
    $cap = $capabilities | Where-Object { ($_.Name -split '~')[0] -eq $capName -and $_.State -ne 'NotPresent' }
    if ($cap) {
        Write-Log &quot;Removing capability $capName...&quot;
        try {
            Remove-WindowsCapability -Online -Name $cap.Name -ErrorAction Continue | Out-Null
        } catch {
            Write-Log &quot;Failed to remove capability $capName: $_&quot;
        }
    }
}

# Remove Optional Features
Write-Log &quot;Removing Optional Features...&quot;
foreach ($feature in $featuresToRemove) {
    if ((Get-WindowsOptionalFeature -Online -FeatureName $feature -ErrorAction SilentlyContinue).State -eq 'Enabled') {
        Write-Log &quot;Disabling feature $feature...&quot;
        try {
            Disable-WindowsOptionalFeature -Online -FeatureName $feature -Remove -NoRestart -ErrorAction Continue | Out-Null
        } catch {
            Write-Log &quot;Failed to disable feature $feature: $_&quot;
        }
    }
}

Write-Log &quot;Debloating Process Completed.&quot;
Write-Progress -Activity &quot;Debloating Windows&quot; -Completed

		</File>
		<File path="C:\Windows\Setup\Scripts\Tweaks\Configure-Privacy.ps1">
$ErrorActionPreference = 'Stop'
. &quot;$PSScriptRoot\Lib\Helper.ps1&quot;

Write-Log &quot;Applying Privacy and Registry Tweaks...&quot;

# Disable Telemetry and Data Collection
reg.exe add &quot;HKLM\SOFTWARE\Policies\Microsoft\Windows\DataCollection&quot; /v AllowTelemetry /t REG_DWORD /d 0 /f
reg.exe add &quot;HKLM\SOFTWARE\Policies\Microsoft\Windows\DataCollection&quot; /v DoNotShowFeedbackNotifications /t REG_DWORD /d 1 /f
reg.exe add &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\DataCollection&quot; /v AllowTelemetry /t REG_DWORD /d 0 /f

# Disable Bing Search and Cortana
reg.exe add &quot;HKLM\SOFTWARE\Policies\Microsoft\Windows\Windows Search&quot; /v AllowCortana /t REG_DWORD /d 0 /f
reg.exe add &quot;HKLM\SOFTWARE\Policies\Microsoft\Windows\Windows Search&quot; /v DisableWebSearch /t REG_DWORD /d 1 /f
reg.exe add &quot;HKLM\SOFTWARE\Policies\Microsoft\Windows\Windows Search&quot; /v ConnectedSearchUseWeb /t REG_DWORD /d 0 /f
reg.exe add &quot;HKLM\SOFTWARE\Policies\Microsoft\Windows\Windows Search&quot; /v AllowCloudSearch /t REG_DWORD /d 0 /f

# Disable Copilot
reg.exe add &quot;HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsCopilot&quot; /v TurnOffWindowsCopilot /t REG_DWORD /d 1 /f
reg.exe add &quot;HKCU\Software\Policies\Microsoft\Windows\WindowsCopilot&quot; /v TurnOffWindowsCopilot /t REG_DWORD /d 1 /f

# Disable News and Interests
reg.exe add &quot;HKLM\SOFTWARE\Policies\Microsoft\Dsh&quot; /v AllowNewsAndInterests /t REG_DWORD /d 0 /f

# Disable Edge First Run and Bloat
reg.exe add &quot;HKLM\Software\Policies\Microsoft\Edge&quot; /v HideFirstRunExperience /t REG_DWORD /d 1 /f
reg.exe add &quot;HKLM\Software\Policies\Microsoft\Edge\Recommended&quot; /v BackgroundModeEnabled /t REG_DWORD /d 0 /f
reg.exe add &quot;HKLM\Software\Policies\Microsoft\Edge\Recommended&quot; /v StartupBoostEnabled /t REG_DWORD /d 0 /f

# Disable BitLocker Automatic Device Encryption
reg.exe add &quot;HKLM\SYSTEM\CurrentControlSet\Control\BitLocker&quot; /v &quot;PreventDeviceEncryption&quot; /t REG_DWORD /d 1 /f

# Disable VBS/HVCI (Performance)
reg.exe add &quot;HKLM\System\CurrentControlSet\Control\DeviceGuard&quot; /v &quot;EnableVirtualizationBasedSecurity&quot; /t REG_DWORD /d 0 /f
reg.exe add &quot;HKLM\System\CurrentControlSet\Control\DeviceGuard\Scenarios\HypervisorEnforcedCodeIntegrity&quot; /v &quot;Enabled&quot; /t REG_DWORD /d 0 /f

# Classic Context Menu (Windows 11) - Requires HKCU, handled in UserOnce or DefaultUser
# Here we can try setting it for default user via reg load or just rely on UserOnce

Write-Log &quot;Privacy Tweaks Applied.&quot;

		</File>
		<File path="C:\Windows\Setup\Scripts\Tweaks\SetStartPins.ps1">
$json = '{&quot;pinnedList&quot;:[]}';
if( [System.Environment]::OSVersion.Version.Build -lt 20000 ) {
	return;
}
$key = 'Registry::HKLM\SOFTWARE\Microsoft\PolicyManager\current\device\Start';
New-Item -Path $key -ItemType 'Directory' -ErrorAction 'SilentlyContinue';
Set-ItemProperty -LiteralPath $key -Name 'ConfigureStartPins' -Value $json -Type 'String';

		</File>
		<File path="C:\Windows\Setup\Scripts\Specialize.ps1">
$ErrorActionPreference = 'Stop'
. &quot;$PSScriptRoot\Lib\Helper.ps1&quot;

$scripts = @(
    &quot;$PSScriptRoot\Drivers\Install-Network.ps1&quot;,
    &quot;$PSScriptRoot\Tweaks\Remove-Bloatware.ps1&quot;,
    &quot;$PSScriptRoot\Tweaks\Configure-Privacy.ps1&quot;,
    &quot;$PSScriptRoot\Drivers\Install-Nvidia.ps1&quot;,
    &quot;$PSScriptRoot\Drivers\Install-AMD.ps1&quot;,
    &quot;$PSScriptRoot\Drivers\Install-Focusrite.ps1&quot;,
    &quot;$PSScriptRoot\Apps\Install-Chrome.ps1&quot;,
    &quot;$PSScriptRoot\Tweaks\SetStartPins.ps1&quot;
)

Write-Log &quot;Starting Specialize Pass (Optimized)...&quot;

foreach ($script in $scripts) {
    if (Test-Path $script) {
        Write-Log &quot;Executing $script...&quot;
        try {
            &amp; $script
        } catch {
            Write-Log &quot;Error executing $script: $_&quot;
        }
    } else {
        Write-Log &quot;Script not found: $script&quot;
    }
}

# Generate SetupComplete.cmd for post-OOBE cleanup
# This ensures unattend.xml remains available for OOBE but is removed before login
$setupCompleteContent = @&quot;
del /q /f &quot;%WINDIR%\Panther\unattend.xml&quot;
del /q /f &quot;%WINDIR%\Panther\unattend-original.xml&quot;
&quot;@

$setupCompletePath = &quot;$env:SystemRoot\Setup\Scripts\SetupComplete.cmd&quot;
try {
    Set-Content -Path $setupCompletePath -Value $setupCompleteContent -Force
    Write-Log &quot;Generated SetupComplete.cmd for cleanup.&quot;
} catch {
    Write-Log &quot;Error creating SetupComplete.cmd: $_&quot;
}

Write-Log &quot;Specialize Pass Completed.&quot;

		</File>
		<File path="C:\Windows\Setup\Scripts\DefaultUser.ps1">
$ErrorActionPreference = 'Stop'
. &quot;$PSScriptRoot\Lib\Helper.ps1&quot;

Write-Log &quot;Configuring Default User...&quot;

# Load Default User Hive
$defaultUserHive = &quot;HKU\DefaultUser&quot;
reg.exe load $defaultUserHive &quot;C:\Users\Default\NTUSER.DAT&quot;

try {
    # Taskbar and Explorer settings
    reg.exe add &quot;$defaultUserHive\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v ShowTaskViewButton /t REG_DWORD /d 0 /f
    reg.exe add &quot;$defaultUserHive\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v TaskbarAl /t REG_DWORD /d 0 /f # Left align taskbar
    reg.exe add &quot;$defaultUserHive\Software\Policies\Microsoft\Windows\Explorer&quot; /v DisableSearchBoxSuggestions /t REG_DWORD /d 1 /f

    # Disable Copilot for Default User
    reg.exe add &quot;$defaultUserHive\Software\Policies\Microsoft\Windows\WindowsCopilot&quot; /v TurnOffWindowsCopilot /t REG_DWORD /d 1 /f

    # Run UserOnce on first login
    reg.exe add &quot;$defaultUserHive\Software\Microsoft\Windows\CurrentVersion\RunOnce&quot; /v &quot;UnattendedSetup&quot; /t REG_SZ /d &quot;powershell.exe -WindowStyle `&quot;Normal`&quot; -ExecutionPolicy `&quot;Unrestricted`&quot; -NoProfile -File `&quot;C:\Windows\Setup\Scripts\UserOnce.ps1`&quot;&quot; /f
}
finally {
    reg.exe unload $defaultUserHive
    [GC]::Collect()
}

Write-Log &quot;Default User Configuration Completed.&quot;

		</File>
		<File path="C:\Windows\Setup\Scripts\UserOnce.ps1">
$ErrorActionPreference = 'Stop'
. &quot;$PSScriptRoot\Lib\Helper.ps1&quot;

Write-Log &quot;Configuring User Account...&quot;

# Disable Copilot
Get-AppxPackage -Name 'Microsoft.Windows.Ai.Copilot.Provider' | Remove-AppxPackage -ErrorAction SilentlyContinue

# Explorer Settings
Set-ItemProperty -LiteralPath 'Registry::HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'LaunchTo' -Type 'DWord' -Value 1 -Force
Set-ItemProperty -LiteralPath 'Registry::HKCU\Software\Microsoft\Windows\CurrentVersion\Search' -Name 'SearchboxTaskbarMode' -Type 'DWord' -Value 3 -Force # Icon only

# Restart Explorer to apply changes
Get-Process -Name 'explorer' -ErrorAction 'SilentlyContinue' | Stop-Process -Force

Write-Log &quot;User Configuration Completed.&quot;

		</File>

	</Extensions>
</unattend>
